<html>
    <head>
        <title>viewer</title>
        <style>canvas { width: 100%; height: 100% }</style>
    </head>
    <body>
        <script src="three.min.js"></script>
        <script src="viewer.js"></script>
        <script src="math.js"></script>
        <script src="s4/s4.js"></script>
        <script src="geo.js"></script>
        <script src="piece_reader.js"></script>
        <script src="solver.js"></script>

        <script>
            var COLORS = [0xaa3333, 0xaaaa33, 0x3333aa, 0x33aaaa, 0x307AEB, 0xEB7330];

            function animate_pieces(pieces, secs){
                secs = secs || 0.1;
                for (var i = 0; i < pieces.length; i++) {
                    (function(i){
                        setTimeout(function() {
                            View.display([View.piece(pieces[i], COLORS[i])]);
                        }, secs*1000*i);
                    })(i);
                }
            }

        function read_pieces(){
            // 'xxOO xOOO OcOO OOOO '+
            // 'xOOO OcOO cccO OcOO '+
            // 'aaOO OaOO OcOO OOOO '+
            // 'OaaO OOOO OOOO OOOO ',

            var test_pieces_str = [
                '..XX .XXX X.XX XXXX '+
                '.XXX X.XX ...X X.XX '+
                '..XX X.XX X.XX XXXX '+
                'X..X XXXX XXXX XXXX ',

                'XX.. X... .X.. .... '+
                'X... .X.. XXX. .X.. '+
                'XX.. .X.. .X.. .... '+
                '.XX. .... .... .... ',

                // '.... .... .... .... '+
                // '.... .X.. .... .... '+
                // '.X.. XXX. .X.. .... '+
                // '.... .X.. .... .... ',

                // '.... .... .... .... '+
                // '.... .... .... .... '+
                // 'X... .... .... .... '+
                // 'XX.. X... .... .... ',

                // '.... .... .... .... '+
                // '.... .... .... .... '+
                // 'XX.. .X.. .... .... '+
                // '.XX. .... .... .... '
            ]

            var test_pieces = [];

            for (var i = 0; i < test_pieces_str.length; i++) {
                test_pieces.push(cube.read_piece(test_pieces_str[i]));
                //document.write('<pre>'+cube.write_piece(test_pieces[i])+'</pre>');
            }

            return test_pieces;
        }

        function displ(pieces){
            View.init();
            var ps = [];

            for (var i = 0; i < pieces.length; i++) {
                ps.push(View.piece(pieces[i], COLORS[i]));
            }

            View.display(ps);
        }

        function show_solutions(){
            var pieces = read_pieces();

            function on_win(pieces){
                document.write('<pre>')
                for (var i = 0; i < pieces.length; i++) {
                    document.write(cube.write_piece(pieces[i]));
                }
                document.write('</pre><hr>');
            }

            cube.solve(pieces, on_win);

            // View.init();
            // animate_pieces(pieces.slice(0,2), 3);
        }

        show_solutions();

        </script>
    </body>
</html>