<html>
    <head>
        <title>viewer</title>
        <style>
            body{
                margin:0;
                padding:0;
                background-color: #333333;
                color:#fff;
            }
            canvas { width: 100%; height: 100% }
            #left{
                position: fixed;
                top:0;
            }
        </style>
    </head>
    <body>
        <script src="cube/math.js"></script>
        <script src="cube/s4/s4.js"></script>
        <script src="cube/geo.js"></script>
        <script src="cube/piece_reader.js"></script>
        <script src="cube/solver.js"></script>

        <script src="cube/problems.js"></script>

        <script src="three.min.js"></script>
        <script src="viewer.js"></script>
        <script src="jquery.js"></script>

        <script>
            var COLORS = [0xaa3333, 0xaaaa33, 0xee7733, 0x33aaaa, 0x307AEB, 0xEB7330];

            function main(){
                var pieces = cube.problem_bedlam;
                var solution;
                var check_state=[];

                function display(pieces){
                    var ps = [];
                    for (var i = 0; i < pieces.length; i++) {
                        ps.push(View.piece(pieces[i], COLORS[i]));
                    }

                    View.display(ps);
                }

                function on_changed(){
                    var ps = [];
                    for (var i = 0; i < pieces.length; i++) {
                        if(check_state[i]){
                            ps.push(View.piece(pieces[i], COLORS[i]));
                        }
                    }

                    View.display(ps);
                }

                function checkboxes(){
                    for (var i = 0; i < pieces.length; i++) {
                        check_state.push(false);
                        (function(i){
                            var domel = $('<input type="checkbox">'+i+'</input>').change(function(){
                                check_state[i] = this.checked;
                                on_changed();
                            });

                            $('#left').append(domel);

                        })(i);
                    }
                }

                function on_win(solution){
                    pieces = solution;
                    on_changed();
                    return false; //stop the search
                }

                View.init(pieces.box);
                checkboxes();
                var resumable_search_step = cube.make_solver(pieces).resumable_search_step;

                var stack = [[]];

                function capusa(){
                    var res = resumable_search_step(stack);
                    if(res.score === -1){
                        setTimeout(capusa,200);
                    }

                    display(res.config);
                    // if(stack.length !== 0){
                        //setTimeout(capusa, 200);
                    // }
                }

                $('#solve').click(function(){
                    capusa();
                });
            }


            $(document).ready(function(){
                main();
            });

        </script>

        <div id="left">
            <button id="solve">step</button>
        </div>

    </body>
</html>